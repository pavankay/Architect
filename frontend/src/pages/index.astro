---
import { Image } from 'astro:assets';
import Layout from '../layouts/Layout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import CreateProjectModal from '../components/CreateProjectModal.astro';
import logo from '../assets/sitebuilder.png';

// Fetch projects from API
let projects = [];
try {
  const response = await fetch('http://localhost:5000/projects');
  projects = response.ok ? await response.json() : [];
} catch (error) {
  console.error('Failed to fetch projects:', error);
  projects = [];
}
---

<Layout title="Architect - AI Site Planning">
  <main class="min-h-screen p-8 bg-pattern-dots">
    <header class="max-w-6xl mx-auto mb-16 animate-fade-in">
      <div class="flex items-center gap-4 mb-4">
        <Image src={logo} alt="Architect Logo" class="h-14 w-14 object-contain" width={56} height={56} />
        <h1 class="font-mono text-4xl tracking-tight">Architect</h1>
      </div>
      <p class="font-mono text-base opacity-80 max-w-lg leading-relaxed">AI-powered site planning and architecture tool for modern developers</p>
    </header>

    <section class="max-w-6xl mx-auto animate-slide-in animate-delay-200">
      <div class="flex justify-between items-center mb-12">
        <div>
          <h2 class="font-mono text-3xl mb-2">Projects</h2>
          <p class="font-mono text-sm opacity-60">Manage and explore your architectural designs</p>
        </div>
        <button
          id="create-project-btn"
          class="bg-white text-black px-8 py-4 font-mono transition-opacity rounded-lg"
        >
          <span class="text-lg">+</span> Create Project
        </button>
      </div>

      {projects.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {projects.map((project: any, index: number) => (
            <div class={`animate-scale-in animate-delay-${Math.min(index * 100 + 300, 600)}`}>
              <ProjectCard
                id={project.id}
                name={project.name}
                description={project.description}
                createdAt={project.created_at}
              />
            </div>
          ))}
        </div>
      ) : (
        <div class="text-center py-24 animate-fade-in animate-delay-300">
          <div class="inline-block p-8 border border-white/10 rounded-2xl bg-white/[0.02]">
            <div class="text-6xl mb-6 opacity-20 font-mono">[ ]</div>
            <h3 class="font-mono text-xl mb-4">No projects yet</h3>
            <p class="font-mono text-sm opacity-60 mb-6 max-w-md mx-auto leading-relaxed">
              Get started by creating your first project. Our AI will help you plan the perfect architecture.
            </p>
            <button
              onclick="document.getElementById('create-project-btn').click()"
              class="bg-white/10 border border-white/20 text-white px-6 py-3 font-mono transition-colors rounded-lg"
            >
              Create Your First Project
            </button>
          </div>
        </div>
      )}
    </section>
  </main>

  <CreateProjectModal />
</Layout>